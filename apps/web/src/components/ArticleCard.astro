---
import type { CollectionEntry } from 'astro:content';
import { css } from '../../styled-system/css';
import { CategoryTag } from './category-tag';
import { getTagById } from '../data/tags';
import { formatDate } from '../utils';

interface Props {
  article: CollectionEntry<'articles'>;
}

const { article } = Astro.props;
const validTagList = article.data.tags.filter((tagId) => typeof getTagById(tagId) !== 'undefined');
---

<article
  class={css({
    display: 'flex',
    flexDirection: 'column',
    gap: 'calc(var(--spacing-unit) * 3)',
    height: '100%',
    borderWidth: '1px',
    borderStyle: 'solid',
    borderColor: 'gray.200',
    borderRadius: '12',
    backgroundColor: 'white',
    padding: 'calc(var(--spacing-unit) * 4)'
  })}
>
  {
    validTagList.length > 0 ? (
      <ul
        class={css({
          display: 'flex',
          flexWrap: 'wrap',
          gap: 'calc(var(--spacing-unit) * 2)'
        })}
      >
        {validTagList.map((tagId) => (
          <li>
            <CategoryTag href={`/categories/${tagId}/1`}>{getTagById(tagId)?.displayName}</CategoryTag>
          </li>
        ))}
      </ul>
    ) : null
  }

  <h2
    class={css({
      color: 'gray.800',
      fontSize: '20',
      fontWeight: '700',
      lineHeight: '150',
      letterSpacing: '0.025em'
    })}
  >
    <a
      href={`/articles/${article.id}`}
      class={css({
        textDecoration: 'none',
        color: 'inherit',
        _hover: {
          color: 'rosePink.700'
        }
      })}
    >
      {article.data.title}
    </a>
  </h2>

  <p
    class={css({
      color: 'gray.700',
      fontSize: '16',
      fontWeight: '400',
      lineHeight: '170',
      letterSpacing: '0.025em',
      flexGrow: '1'
    })}
  >
    {article.data.description}
  </p>

  <time
    datetime={article.data.publishedDate.toISOString()}
    class={css({
      color: 'gray.600',
      fontSize: '16',
      fontWeight: '400',
      lineHeight: '150',
      letterSpacing: '0.025em'
    })}
  >
    {formatDate('YYYY.MM.DD')(article.data.publishedDate)} 公開
  </time>
</article>
